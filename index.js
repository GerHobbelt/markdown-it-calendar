"use strict";require("./calendar.css");var weeks=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months=["January","February","March","April","May","June","July","August","September","October","November","December"];module.exports=function(r,e){function t(r){r=r.trim().split(" ");try{var e=(parseInt(r[0]),parseInt(r[1]));return e<=12&&e>=1}catch(r){return!1}}function n(r){var e=new Date(r.Date.year,r.Date.month,0),t=e.getDate();e.setDate(1);var n=e.getDay(),a=document.createElement("table"),i=void 0,s=void 0;a.className="calendar",i=a.insertRow(),s=i.insertCell(),s.colSpan="7",s.innerHTML=r.Date.year+"-"+months[parseInt(r.Date.month)-1],i=a.insertRow();for(var o=0;o<7;++o)s=i.insertCell(),s.innerHTML=weeks[o];for(var u=0;u<n;++u)u%7==0&&(i=a.insertRow()),s=i.insertCell();for(var c=n;c<t+n;++c){var l=c-n+1;c%7==0&&(i=a.insertRow()),s=i.insertCell(),e.setDate(l),s.innerHTML=l+"<br>",r.Content[e]&&r.Content[e].forEach(function(r){s.innerHTML+=r.title+":"+r.description+"<br>"})}for(var f=t+n;f%7!=0;++f)s=i.insertCell();return a.outerHTML}function a(r,e,t,a,i){return'<div class="markdown-it-calendar">'+n(r[e].info)+"</div>"}function i(r){try{var e=new Date(r.year,r.month-1,r.date);return!!(r.year===e.getFullYear()&&r.month===e.getMonth()+1&&r.date===e.getDate())&&e}catch(r){return!1}return!1}function s(r,e,t,n){var a="]"===r[t-1];if(!a)return!1;if(!(a=r.substring(e,e+m.length)===m))return!1;if(!(a=n(r.substring(e+m.length,t-1))))return!1;var i=r.substring(e+m.length,t-1).trim().split(" ");return{year:parseInt(i[0]),month:parseInt(i[1])}}function o(r,e,t){return r.substring(e,t).trim()==p}function u(r,e,t,n){var a=r.substring(e,t).trim();try{var s=a.match(h),o=Object.assign({},n);return o.date=parseInt(s[1]),i(o)}catch(r){return!1}return!1}function c(r,e,t){var n=r.substring(e,t).trim();try{var a=n.match(d);return{title:a[1],description:a[2]}}catch(r){return!1}return!1}function l(r,e){var t=r.push(e.type,e.tag||"div",e.nesting);return t.markup=e.markup||"",t.block=e.block||!0,t.content=e.content||"","info"in e&&(t.info=e.info),"map"in e&&(t.map=e.map),t}function f(r,e,t,n){var a=void 0,i=void 0,f=0,h=r.bMarks[e]+r.tShift[e],d=r.eMarks[e],g={Date:{},Content:{}},y=s(r.src,h,d,b);if(y===!1)return!1;if(n)return!0;for(g.Date=y,a=e+1;a<t;++a){h=r.bMarks[a]+r.tShift[a],d=r.eMarks[a];var k=u(r.src,h,d,y);if(k)i=k;else if(event=c(r.src,h,d),i&&event)g.Content[i]=g.Content[i]||[],g.Content[i].push(event);else if(r.src[h]===p[0]&&o(r.src,h,d)){f=1;break}}return r.line=a+f,l(r,{type:v,nesting:0,markup:m,info:g,map:[e,r.line],content:""}),!0}var v="calendar",m="#["+v+"=",p="#[/"+v+"]",h=/<!--\s*(\d+)\s*-->/,d=/@\[(.*?)\](.*)/;e=e||{};var b=e.validateParam||t;e.render;r.block.ruler.before("fence",v,f,{alt:["paragraph","blockquote","list"]}),r.renderer.rules[v]=a};