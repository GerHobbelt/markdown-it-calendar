"use strict";function _interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}var _assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_calendar=require("./calendar"),_calendar2=_interopRequireDefault(_calendar);require("./calendar.css"),module.exports=function(r,e){function t(r,e,t,n,a){var i=r[e].info;return'<div class="markdown-it-calendar">'+(0,_calendar2.default)(i)+"</div>"}function n(r){try{var e=new Date(r.year,r.month-1,r.date);e.setFullYear(r.year);return r.year===e.getFullYear()&&r.month===e.getMonth()+1&&r.date===e.getDate()?e:"Invalid"}catch(r){return!1}return!1}function a(r){try{if(r=r.trim(),r=r.match(p)){var e=parseInt(r[1]),t=parseInt(r[2]);return e>=0&&e<=1e5&&t>=1&&t<=12}return!1}catch(r){return!1}}function i(r,e,t){var n="]"===r[t-1];if(!n)return!1;if(!(n=r.substring(e,e+d.length)===d))return!1;if(!(n=a(r.substring(e+d.length,t-1))))return!1;var i=r.substring(e+d.length,t-1).trim().match(p);return{year:parseInt(i[1]),month:parseInt(i[2])}}function u(r,e,t){return r.substring(e,t).trim()==v}function s(r,e,t,a){var i=r.substring(e,t).trim();try{var u=i.match(m),s=(0,_assign2.default)({},a);return s.date=parseInt(u[1]),n(s)}catch(r){return!1}return!1}function c(r,e,t){var n=r.substring(e,t).trim();try{var a=n.match(g);return{title:a[1],description:a[2]}}catch(r){return!1}return!1}function o(r,e){var t=r.push(e.type,e.tag||"div",e.nesting);return t.markup=e.markup||"",t.block=e.block||!0,t.content=e.content||"","info"in e&&(t.info=e.info),"map"in e&&(t.map=e.map),t}function l(r,e,t,n){var a=void 0,l=void 0,p=0,m=r.bMarks[e]+r.tShift[e],g=r.eMarks[e],h={Date:{},Content:{}},b=i(r.src,m,g);if(b===!1)return!1;if(n)return!0;for(h.Date=b,a=e+1;a<t;++a){m=r.bMarks[a]+r.tShift[a],g=r.eMarks[a];var k=s(r.src,m,g,b);if("Invalid"===k)l=void 0;else if(k){l=k;continue}if(event=c(r.src,m,g),l&&event)h.Content[l]=h.Content[l]||[],h.Content[l].push(event);else if(r.src[m]===v[0]&&u(r.src,m,g)){p=1;break}}return r.line=a+p,o(r,{type:f,nesting:0,markup:d,info:h,map:[e,r.line],content:""}),!0}var f="calendar",d="#["+f+"=",v="#[/"+f+"]",p=/^(\d+)[ ]+(\d+)$/,m=/<!--\s*(\d+)\s*-->/,g=/@\[(.*?)\](.*)/;e=e||{};e.render;r.block.ruler.before("fence",f,l,{alt:["paragraph","blockquote","list"]}),r.renderer.rules[f]=t};