"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_calendar=require("./calendar"),_calendar2=_interopRequireDefault(_calendar);require("./calendar.css"),module.exports=function(e,r){function t(r,t,n,a,i){var s=r[t].info,u=(0,_calendar2.default)(e,s);return'<div class="markdown-it-calendar '+("dark"===s.Style?"dark":"")+'">'+u+"</div>"}function n(e){try{var r=new Date(e.year,e.month-1,e.date);r.setFullYear(e.year);return!!(e.year===r.getFullYear()&&e.month===r.getMonth()+1&&e.date===r.getDate())&&r}catch(e){return!1}return!1}function a(e){if(e=e.match(p))try{var r=e[2],t=parseInt(e[3]),n=parseInt(e[4]);if(t>=0&&t<=1e5&&n>=1&&n<=12)return{style:r,year:t,month:n}}catch(e){return console.error("PARAMS_REGEX is invalid"),!1}return!1}function i(e,r,t){return!(e.substring(r,r+v.length).toLowerCase()!==v)&&a(e.substring(r+v.length,t))}function s(e,r,t){return e.substring(r,t).trim()==y}function u(e,r,t,a){var i=e.substring(r,t).trim(),s=i.match(g);if(s)try{var u=(0,_assign2.default)({},a);return u.date=parseInt(s[1]),{title:s[3],day:n(u)}}catch(e){return console.error("DATE_REGEX is invalid"),!1}return!1}function o(e,r,t){var n=e.substring(r,t).trim(),a=n.match(h);if(a)try{return{tag:a[1],description:a[2]}}catch(e){return console.error("EVENT_REGEX is invalid"),!1}return!1}function c(e,r,t,n){var a=r.substring(t,n);e.description+="\n"+a}function l(e,r){var t=e.push(r.type,r.tag||"div",r.nesting);return t.markup=r.markup||"",t.block=r.block||!0,t.content=r.content||"","info"in r&&(t.info=r.info),"map"in r&&(t.map=r.map),t}function d(e,r,t,n){var a=void 0,d=void 0,p=void 0,g=0,h=e.bMarks[r]+e.tShift[r],m=e.eMarks[r],_={Year:-1,Month:0,Days:{}},E=i(e.src,h,m);if(!E)return!1;if(n)return!0;for(_.Style=E.style,_.Year=E.year,_.Month=E.month,a=r+1;a<t;++a){h=e.bMarks[a]+e.tShift[a],m=e.eMarks[a];var b=u(e.src,h,m,E);if(b.day)p=void 0,d=b.day,_.Days[d]=_.Days[d]||{},_.Days[d].title=b.title,_.Days[d].startLine=a;else if(event=o(e.src,h,m),d&&event)p=event,p.startLine=a,_.Days[d].events=_.Days[d].events||[],_.Days[d].events.push(event);else{if(e.src[h]===y[0]&&s(e.src,h,m)){g=1;break}p&&c(p,e.src,h,m)}}return e.line=a+g,_.startLine=r,_.endLine=t,l(e,{type:f,nesting:0,markup:v,info:_,map:[r,e.line],content:""}),!0}r=r||{};var f="calendar",v=r.startMarker||":::"+f,y=r.endMarker||":::",p=r.PARAMS_REGEX||/^(\((.*)\)){0,1}\s+(\d+)[ ]+(\d+)\s*$/,g=r.DATE_REGEX||/^[+*-]\s+(\d{1,2})(\s(.*))?$/,h=r.EVENT_REGEX||/^[-*+]\s*\[(.*?)\]\s*(.*)$/;r.render;e.block.ruler.before("fence",f,d,{alt:["paragraph","blockquote"]}),e.renderer.rules[f]=t};