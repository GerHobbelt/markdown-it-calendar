"use strict";function _interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}var _calendar=require("./calendar"),_calendar2=_interopRequireDefault(_calendar);require("./calendar.css"),module.exports=function(r,t){function e(r){r=r.trim().split(" ");try{var t=(parseInt(r[0]),parseInt(r[1]));return t<=12&&t>=1}catch(r){return!1}}function n(r,t,e,n,a){var i=r[t].info;return'<div class="markdown-it-calendar">'+(0,_calendar2.default)(i)+"</div>"}function a(r){try{var t=new Date(r.year,r.month-1,r.date);return!!(r.year===t.getFullYear()&&r.month===t.getMonth()+1&&r.date===t.getDate())&&t}catch(r){return!1}return!1}function i(r,t,e,n){var a="]"===r[e-1];if(!a)return!1;if(!(a=r.substring(t,t+d.length)===d))return!1;if(!(a=n(r.substring(t+d.length,e-1))))return!1;var i=r.substring(t+d.length,e-1).trim().split(" ");return{year:parseInt(i[0]),month:parseInt(i[1])}}function u(r,t,e){return r.substring(t,e).trim()==p}function s(r,t,e,n){var i=r.substring(t,e).trim();try{var u=i.match(v),s=Object.assign({},n);return s.date=parseInt(u[1]),a(s)}catch(r){return!1}return!1}function c(r,t,e){var n=r.substring(t,e).trim();try{var a=n.match(m);return{title:a[1],description:a[2]}}catch(r){return!1}return!1}function o(r,t){var e=r.push(t.type,t.tag||"div",t.nesting);return e.markup=t.markup||"",e.block=t.block||!0,e.content=t.content||"","info"in t&&(e.info=t.info),"map"in t&&(e.map=t.map),e}function l(r,t,e,n){var a=void 0,l=void 0,v=0,m=r.bMarks[t]+r.tShift[t],g=r.eMarks[t],b={Date:{},Content:{}},k=i(r.src,m,g,h);if(k===!1)return!1;if(n)return!0;for(b.Date=k,a=t+1;a<e;++a){m=r.bMarks[a]+r.tShift[a],g=r.eMarks[a];var y=s(r.src,m,g,k);if(y)l=y;else if(event=c(r.src,m,g),l&&event)b.Content[l]=b.Content[l]||[],b.Content[l].push(event);else if(r.src[m]===p[0]&&u(r.src,m,g)){v=1;break}}return r.line=a+v,o(r,{type:f,nesting:0,markup:d,info:b,map:[t,r.line],content:""}),!0}var f="calendar",d="#["+f+"=",p="#[/"+f+"]",v=/<!--\s*(\d+)\s*-->/,m=/@\[(.*?)\](.*)/;t=t||{};var h=t.validateParam||e;t.render;r.block.ruler.before("fence",f,l,{alt:["paragraph","blockquote","list"]}),r.renderer.rules[f]=n};